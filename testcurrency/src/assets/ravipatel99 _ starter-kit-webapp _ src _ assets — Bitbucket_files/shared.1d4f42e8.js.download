!function(){function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirecbf3;r.register("bo7sg",(function(t,n){e(t.exports,"default",(function(){return r("k8My7").default}));r("k8My7")})),r.register("k8My7",(function(n,s){e(n.exports,"default",(function(){return b}));var a=r("jgze0"),o=r("7HEfz"),i=r("4Rd8x"),l=r("eImGs"),f=r("6Vf6Q"),c=r("ftmvl"),d=r("61szk"),p=r("7RIig"),u=r("8ZneY"),g=r("1l11a"),h=r("fxZzh"),m=r("lvPTm");class R extends d.PureComponent{toggle(){this.state.isOpen||this.props.onOpen(),this.setState((e=>({isOpen:!e.isOpen})))}render(){const{renderRef:e,repository:r}=this.props,{isOpen:n}=this.state;return t(d).createElement(g.RefSelectorWrapper,{"data-qa":"ref-selector"},t(d).createElement(g.InlineDialogWrapper,null,t(d).createElement(c.Popup,{isOpen:n,onClose:this.handleClose,placement:"bottom-start",trigger:this.renderTrigger,content:({setInitialFocusRef:n})=>t(d).createElement(g.PopupContentWrapper,null,t(d).createElement(m.default,{onRefSelected:this.handleRefSelected,renderRef:e,repository:r,setInitialFocusRef:n}))})))}constructor(...e){super(...e),this.state={isOpen:!1},this.handleClose=()=>this.setState({isOpen:!1}),this.handleRefSelected=e=>{this.setState({isOpen:!1}),this.props.onChange(e)},this.renderTrigger=e=>{const{isOpen:r}=this.state,{intl:n,label:s}=this.props,c=s||t(d).createElement(p.FormattedMessage,h.default.noRefSelected);return t(d).createElement(i.default,{content:c,tag:"p",position:"top"},t(d).createElement(o.default,t(a)({},e,{isSelected:r,iconBefore:t(d).createElement(t(l),{size:"medium",label:""}),iconAfter:t(d).createElement(t(f),{label:""}),testId:"ref-selector-trigger",onClick:()=>{this.toggle()}}),t(d).createElement(u.ScreenReadersOnly,null,n.formatMessage(h.default.refSourceLabel)),c))}}}R.defaultProps={onChange:()=>{},onOpen:()=>{}};var b=p.injectIntl(R)})),r.register("1l11a",(function(t,n){e(t.exports,"Filter",(function(){return l})),e(t.exports,"RefLink",(function(){return f})),e(t.exports,"RefSelectorPanel",(function(){return c})),e(t.exports,"InlineDialogWrapper",(function(){return d})),e(t.exports,"PopupContentWrapper",(function(){return p})),e(t.exports,"RefSelectorWrapper",(function(){return u}));var s=r("eQkAL"),a=r("6aCAs"),o=r("bIFRd"),i=r("l3XSZ");const l=s.default("div",{target:"e1tv17y60"})("margin-bottom:",a.gridSize(),"px;padding-left:",a.gridSize(),"px;padding-right:",a.gridSize(),"px;"),f=s.default(i.ComponentLinkProxy,{target:"e1tv17y61"})({name:"1tmlw65",styles:"padding:6px 0;line-height:initial;"}),c=s.default("div",{target:"e1tv17y62"})("width:",44*a.gridSize(),"px;",o.media.upToSmall("\n    width: 300px;\n  "),""),d=s.default("div",{target:"e1tv17y63"})("& > div{padding:",2*a.gridSize(),"px ",2*a.gridSize(),"px 0;}"),p=s.default("div",{target:"e1tv17y64"})("padding:",2*a.gridSize(),"px ",2*a.gridSize(),"px 0;"),u=s.default("div",{target:"e1tv17y65"})({name:"139lh2g",styles:"max-width:fit-content;width:calc(100% - 200px);"})})),r.register("fxZzh",(function(t,n){e(t.exports,"default",(function(){return s}));var s=r("7RIig").defineMessages({branchesTab:{id:"frontbucket.repository.source.refSelector.branchesTab",defaultMessage:"Branches"},filterBranches:{id:"frontbucket.repository.source.refSelector.filterBranches",defaultMessage:"Filter branches"},filterTags:{id:"frontbucket.repository.source.refSelector.filterTags",defaultMessage:"Filter tags"},loadMore:{id:"frontbucket.repository.source.refSelector.loadMore",defaultMessage:"Load more"},noRefSelected:{id:"frontbucket.repository.source.refSelector.noRefSelected",defaultMessage:"Select a ref"},noResultsBranches:{id:"frontbucket.repository.source.refSelector.noResultsBranches",defaultMessage:"We can't find branches with that name."},tagsEmptyState:{id:"frontbucket.repository.source.refSelector.tagsEmptyState",defaultMessage:"There are no tags in this repository."},noResultsTags:{id:"frontbucket.repository.source.refSelector.noResultsTags",defaultMessage:"We can't find tags with that name."},refSourceLabel:{id:"frontbucket.repository.source.refSelector.refBranchLabel",defaultMessage:"source:"},tagsTab:{id:"frontbucket.repository.source.refSelector.tagsTab",defaultMessage:"Tags"}})})),r.register("lvPTm",(function(n,s){e(n.exports,"default",(function(){return g}));var a=r("8Dfgu"),o=r("9HN8i"),i=r("hp8zO"),l=r("61szk"),f=r("7RIig"),c=r("lVRFJ"),d=r("fxZzh"),p=r("1l11a");class u extends t(l).PureComponent{renderTabs(){const{intl:e,onRefSelected:r,renderRef:n,repository:s}=this.props,{filter:a}=this.state,o=t(l).createElement(c.default,{filter:a,onRefSelected:r,renderRef:n,repository:s,type:"branch"}),i=t(l).createElement(c.default,{filter:a,onRefSelected:r,renderRef:n,repository:s,type:"tag"});return[{content:o,label:e.formatMessage(d.default.branchesTab)},{content:i,label:e.formatMessage(d.default.tagsTab)}]}render(){const{selectedTabIndex:e}=this.state,{setInitialFocusRef:r}=this.props;return t(l).createElement(p.RefSelectorPanel,null,t(l).createElement(p.Filter,null,t(l).createElement(a.default,{ref:r,"aria-label":`${this.placeholders[e]}`,onChange:e=>{this.handleFilterChange(e.target.value)},placeholder:this.placeholders[e]})),t(l).createElement(o.default,{onSelect:this.onTabSelected,selected:e,tabs:this.renderTabs()}))}constructor(...e){super(...e),this.state={filter:"",selectedTabIndex:0},this.handleFilterChange=i.debounce((e=>this.setState({filter:e})),200),this.onTabSelected=(e,t)=>{this.setState({selectedTabIndex:t})},this.placeholders=[this.props.intl.formatMessage(d.default.filterBranches),this.props.intl.formatMessage(d.default.filterTags)]}}var g=f.injectIntl(u)})),r.register("lVRFJ",(function(t,n){e(t.exports,"default",(function(){return i}));var s=r("6tbO4"),a=r("69smv"),o=r("eBkYl");var i=s.connect((e=>({mainRef:a.getRepositoryMainBranch(e),branchingModel:a.getRepositoryBranchingModel(e)})))(o.default)})),r.register("eBkYl",(function(n,s){e(n.exports,"default",(function(){return l}));var a=r("61szk"),o=r("bAF0X"),i=r("hbaGX");class l extends a.PureComponent{componentDidMount(){const{filter:e,repository:t,type:r,mainRef:n,branchingModel:s}=this.props;this.fetchRefs(t,e,r,n,s)}UNSAFE_componentWillReceiveProps(e){const{filter:t,repository:r,type:n,mainRef:s,branchingModel:a}=e;t===this.props.filter&&n===this.props.type&&(!r||this.props.repository&&this.props.repository.uuid===r.uuid)||this.fetchRefs(r,t,n,s,a),this.props.type!==n&&this.setState({refs:[]})}render(){const{onRefSelected:e,renderRef:r,type:n,filter:s}=this.props,{isLoading:i,refs:l,nextPageUrl:f}=this.state,c="tag"===n&&""!==s;return t(a).createElement(o.default,{nextPageUrl:f,isLoading:i,isFiltered:c,onLoadMorePages:this.onLoadMorePages,onRefSelected:e,refs:l,renderRef:r,type:n})}constructor(...e){super(...e),this.state={isLoading:!1,refs:[],nextPageUrl:null},this.fetchRefs=(e,t,r,n,s)=>{const{full_name:a}=e,o=i.generateRefUrl(a,t,r,n,s);this.fetchRefsFromUrl(o,!0)},this.onLoadMorePages=e=>{this.fetchRefsFromUrl(e,!1)},this.fetchRefsFromUrl=async(e,t)=>{this.setState({isLoading:!0});const{refs:r}=this.state,{type:n,mainRef:s,branchingModel:a,filter:o}=this.props;try{const{next:l,preparedRefs:f}=await i.fetchRefOptions(e,t,o,n,s,a);this.setState({isLoading:!1,nextPageUrl:l,refs:t?f:r.concat(f)})}catch(e){}},this.shouldShowRef=e=>{const{filter:t}=this.props;return!(!e||!e.name)&&e.name.includes(t)}}}l.defaultProps={filter:""}})),r.register("bAF0X",(function(n,s){e(n.exports,"default",(function(){return d}));var a=r("1HQ2H"),o=r("61szk"),i=r("7RIig"),l=r("hp8zO"),f=r("g9AQ7"),c=r("fxZzh");class d extends o.PureComponent{renderContents(){const{refs:e,type:r,isFiltered:n}=this.props;return"tag"===r&&0===e.length?n?t(o).createElement(i.FormattedMessage,c.default.noResultsTags):t(o).createElement(i.FormattedMessage,c.default.tagsEmptyState):"branch"===r&&0===e.length?t(o).createElement(i.FormattedMessage,c.default.noResultsBranches):e.map(((e,r)=>t(o).createElement(f.RefListItem,{key:r},this.renderRef(e))))}render(){const{isLoading:e,refs:r}=this.props;return!e||r&&0!==r.length?t(o).createElement(f.ScrollableContents,{onScroll:e=>{e.persist(),this.onLoadMoreScrollHandler(e)}},t(o).createElement(f.RefList,{role:"list"},this.renderContents()),t(o).createElement(f.SpinnerContainer,null,e&&t(o).createElement(a.default,{size:"medium"}))):t(o).createElement(f.LoadingContainer,null,t(o).createElement(a.default,{size:"medium"}))}constructor(...e){super(...e),this.renderRef=e=>{const r=this.props.renderRef(e);return t(o).cloneElement(r,{key:e.name,onClick:t=>{r.props.onClick&&r.props.onClick(t),this.props.onRefSelected(e)}})},this.onLoadMoreScrollHandler=l.debounce((e=>{const t=e.target,{nextPageUrl:r,isLoading:n,onLoadMorePages:s}=this.props;r&&!n&&t.scrollHeight-t.scrollTop<t.clientHeight+100&&s(r)}),200)}}d.defaultProps={hasMore:!1,isLoading:!1,onLoadMorePages:()=>{},onRefSelected:()=>{},refs:[],renderRef:e=>t(o).createElement(f.RefButton,{appearance:"link"},e.name)}})),r.register("g9AQ7",(function(t,n){e(t.exports,"LoadingContainer",(function(){return i})),e(t.exports,"SpinnerContainer",(function(){return l})),e(t.exports,"RefButton",(function(){return f})),e(t.exports,"RefList",(function(){return c})),e(t.exports,"RefListItem",(function(){return d})),e(t.exports,"ScrollableContents",(function(){return p}));var s=r("eQkAL"),a=r("7HEfz"),o=r("6aCAs");const i=s.default("div",{target:"eq214we0"})("display:flex;justify-content:center;align-items:center;margin:",o.gridSize(),"px;width:100%;min-height:70px;"),l=s.default(i,{target:"eq214we1"})("min-height:",4*o.gridSize(),"px;"),f=s.default(a.default,{target:"eq214we2"})({name:"l5nox8",styles:"&&{padding-left:0;text-align:left;}& span{margin-left:0;}"}),c=s.default("ul",{target:"eq214we3"})("list-style:none;padding-top:",o.gridSize(),"px;padding-left:0;"),d=s.default("li",{target:"eq214we4"})({name:"1oj327w",styles:"margin-top:0;a{display:block;}"}),p=s.default("div",{target:"eq214we5"})({name:"1t3a98l",styles:"min-height:86px;max-height:300px;overflow-y:auto;overflow-x:hidden;width:100%;"})})),r.register("hbaGX",(function(n,s){e(n.exports,"generateRefUrl",(function(){return f})),e(n.exports,"fetchRefOptions",(function(){return d}));var a=r("cJOGA"),o=r("hp8zO"),i=r("eIict"),l=r("clBu2");const f=(e,r,n,s,o,i)=>{const[f,c]=e.split("/"),d="branch"===n?l.default.api.v20.branches(f,c):l.default.api.v20.tags(f,c);let p=s?[s.name]:[];if(o){const{production:e,development:t}=o,r=[e,t].filter((e=>!!e&&!e.use_mainbranch));p=[...p,...r.map((e=>e.name))]}const u=p.map((e=>`name != "${e}" AND `)).join(""),g=i||("branch"===n?"name":"-target.date");return`${d}?${t(a).stringify({pagelen:25,q:"branch"===n?`${u} name ~ "${r}"`:`name ~ "${r}"`,sort:g,fields:"-values.target.*,+values.target.hash"})}`},c=(e,t)=>!(!e||!e.name)&&e.name.includes(t),d=async(e,t,r,n,s,a)=>{const l=await fetch(i.default(e));if(!l.ok)throw Error();const{next:f,values:d}=await l.json();let p=d;if("branch"===n){let e=[];if(c(s,r)&&t&&(e=[s]),a){const{development:n,production:s}=a,i=[n,s].filter((e=>!!e&&!e.use_mainbranch&&c(e,r)&&t));e=o.uniqBy([...e,...i],"name")}return p=[...e,...p],{preparedRefs:p,next:f}}return{preparedRefs:p,next:f}}}))}();
//# sourceMappingURL=shared.1d4f42e8.js.map
